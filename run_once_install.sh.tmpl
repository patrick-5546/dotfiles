{{ if eq .chezmoi.os "linux" -}}
#!/bin/sh

{{ if eq .chezmoi.osRelease.id "ubuntu" -}}
sudo apt -y update && sudo apt -y install \
    bpytop \
    fd-find \
    fzf \
    neovim \
    ripgrep \
    tmux \
    zsh \
    zsh-syntax-highlighting

# symlink fd-find to fd
if [[ command -v fdfind > /dev/null 2>&1 ]] && [[ ! -f ~/.local/bin/fd ]]
then
    ln -s $(which fdfind) ~/.local/bin/fd
fi

{{- else if eq .chezmoi.osRelease.id "fedora" -}}
sudo dnf -y update && sudo dnf -y install 'dnf-command(config-manager)'
sudo dnf -y config-manager --add-repo https://cli.github.com/packages/rpm/gh-cli.repo
sudo dnf -y update && sudo dnf -y install \
    bpytop \
    fontconfig \
    fd-find \
    fzf \
    gh \
    git-delta \
    neovim \
    ripgrep \
    starship \
    tmux \
    unzip \
    util-linux-user \
    zsh \
    zsh-syntax-highlighting
{{- end }}

{{ if not (.chezmoi.kernel.osrelease | lower | contains "microsoft") -}}
# Install fonts
if [ ! -d ~/.local/share/fonts/FiraCode ]
then
    mkdir -p ~/.local/share/fonts/FiraCode
    curl -L https://github.com/ryanoasis/nerd-fonts/releases/latest/download/FiraCode.zip --output FiraCode.zip
    unzip FiraCode.zip -d ~/.local/share/fonts/FiraCode "Fira*Mono.ttf"
    rm FiraCode.zip
    fc-cache -f
fi

# Login to GitHub
{{ if eq .chezmoi.osRelease.id "ubuntu" -}}
sudo apt install gh -y
{{- end }}
gh auth status
if [ $? -ne 0 ]
then
   gh auth login
fi
{{- end }}

# Make Zsh default shell
if [ $SHELL != "/usr/bin/zsh" ]
then
    chsh -s /usr/bin/zsh
fi

# Create Zsh history file
if [ ! -f ~/.cache/zsh/history ]
then
    mkdir -p ~/.cache/zsh
    touch ~/.cache/zsh/history
fi
{{- end }}
